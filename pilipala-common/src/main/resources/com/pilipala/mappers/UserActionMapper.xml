<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pilipala.mappers.UserActionMapper">
    <!--实体映射-->
    <resultMap id="base_result_map" type="com.pilipala.entity.po.UserAction">
        <!--自增加-->
        <id column="action_id" property="actionId"/>
        <!--视频ID-->
        <result column="video_id" property="videoId"/>
        <!--视频用户ID-->
        <result column="video_user_id" property="videoUserId"/>
        <!--评论ID-->
        <result column="comment_id" property="commentId"/>
        <!--0:评论喜欢点赞 1:讨厌评论 2:视频点赞 3:视频收藏 4:视频投币-->
        <result column="action_type" property="actionType"/>
        <!--数量-->
        <result column="action_count" property="actionCount"/>
        <!--用户ID-->
        <result column="user_id" property="userId"/>
        <!--操作时间-->
        <result column="action_time" property="actionTime"/>
   </resultMap>
    <!--通用查询结果列-->
<sql id="base_column_list">
	action_id,video_id,video_user_id,comment_id,action_type,action_count,user_id,action_time
    </sql>

    <!--基础查询条件-->
    <sql id="base_query_condition">
		<if test="query.actionId!=null">
			and action_id=#{query.actionId} 
		</if>
		<if test="query.videoId!=null and query.videoId!=''">
			and video_id=#{query.videoId} 
		</if>
		<if test="query.videoUserId!=null and query.videoUserId!=''">
			and video_user_id=#{query.videoUserId} 
		</if>
		<if test="query.commentId!=null">
			and comment_id=#{query.commentId} 
		</if>
		<if test="query.actionType!=null">
			and action_type=#{query.actionType} 
		</if>
		<if test="query.actionCount!=null">
			and action_count=#{query.actionCount} 
		</if>
		<if test="query.userId!=null and query.userId!=''">
			and user_id=#{query.userId} 
		</if>
		<if test="query.actionTime!=null">
			and action_time=#{query.actionTime} 
		</if>
    </sql>
    <!--扩展查询条件-->
    <sql id="base_query_condition_extend">
		<if test="query.videoIdFuzzy!=null and query.videoIdFuzzy!=''">
			and video_id like concat('%',#{query.videoIdFuzzy},'%')
		</if>
		<if test="query.videoUserIdFuzzy!=null and query.videoUserIdFuzzy!=''">
			and video_user_id like concat('%',#{query.videoUserIdFuzzy},'%')
		</if>
		<if test="query.userIdFuzzy!=null and query.userIdFuzzy!=''">
			and user_id like concat('%',#{query.userIdFuzzy},'%')
		</if>
		<if test="query.actionTimeStart!=null and query.actionTimeStart!=''">
			<![CDATA[ and  action_time >= str_to_date(#{query.actionTimeStart},'%Y-%m-%d') ]]>
		</if>
		<if test="query.actionTimeEnd!=null and query.actionTimeEnd!=''">
			<![CDATA[ and  action_time < date_sub(str_to_date(#{query.actionTimeEnd},'%Y-%m-%d'),interval -1 day) ]]>
		</if>
    </sql>
    <!--通用查询条件-->
    <sql id="query_condition">
        <where>
            <include refid="base_query_condition"/>
            <if test="query.actionTypeArray!=null and query.actionTypeArray.length>0">
                and action_type in(<foreach collection="query.actionTypeArray" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <include refid="base_query_condition_extend"/>
        </where>
    </sql>
    <!--查询列表-->
	<select id="selectList" resultMap="base_result_map">
		SELECT <include refid="base_column_list"/> FROM user_action <include refid="query_condition"/>
		<if test="query.orderBy!=null"> order by ${query.orderBy}</if>
		<if test="query.simplePage!=null">limit #{query.simplePage.start},#{query.simplePage.end}</if>
	</select>
  <!--查询数量-->
	<select id="selectCount"  resultType="java.lang.Integer">
		SELECT count(1) FROM user_action <include refid="query_condition"/>
	</select>
    <!--插入(匹配有值的字段)-->
	<insert id="insert"  parameterType="com.pilipala.entity.po.UserAction">
		<selectKey keyProperty="bean.action_id" resultType="Integer" order="AFTER">
			SELECT LAST_INSERT_ID();
		</selectKey>
		insert into user_action
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.actionId!=null">
				action_id,
			</if>
			<if test="bean.videoId!=null">
				video_id,
			</if>
			<if test="bean.videoUserId!=null">
				video_user_id,
			</if>
			<if test="bean.commentId!=null">
				comment_id,
			</if>
			<if test="bean.actionType!=null">
				action_type,
			</if>
			<if test="bean.actionCount!=null">
				action_count,
			</if>
			<if test="bean.userId!=null">
				user_id,
			</if>
			<if test="bean.actionTime!=null">
				action_time,
			</if>
		</trim>
		<trim prefix="values(" suffix=")" suffixOverrides=",">
 			<if test="bean.actionId!=null">
 				#{bean.actionId},
			 </if>
 			<if test="bean.videoId!=null">
 				#{bean.videoId},
			 </if>
 			<if test="bean.videoUserId!=null">
 				#{bean.videoUserId},
			 </if>
 			<if test="bean.commentId!=null">
 				#{bean.commentId},
			 </if>
 			<if test="bean.actionType!=null">
 				#{bean.actionType},
			 </if>
 			<if test="bean.actionCount!=null">
 				#{bean.actionCount},
			 </if>
 			<if test="bean.userId!=null">
 				#{bean.userId},
			 </if>
 			<if test="bean.actionTime!=null">
 				#{bean.actionTime},
			 </if>
		 </trim>
	</insert>
    <!--插入或者更新(匹配有值的字段)-->
	<insert id="insertOrUpdate"  parameterType="com.pilipala.entity.po.UserAction">
		insert into user_action
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.actionId!=null">
				action_id,
			</if>
			<if test="bean.videoId!=null">
				video_id,
			</if>
			<if test="bean.videoUserId!=null">
				video_user_id,
			</if>
			<if test="bean.commentId!=null">
				comment_id,
			</if>
			<if test="bean.actionType!=null">
				action_type,
			</if>
			<if test="bean.actionCount!=null">
				action_count,
			</if>
			<if test="bean.userId!=null">
				user_id,
			</if>
			<if test="bean.actionTime!=null">
				action_time,
			</if>
		</trim>
		<trim prefix="values(" suffix=")" suffixOverrides=",">
 			<if test="bean.actionId!=null">
 				#{bean.actionId},
			 </if>
 			<if test="bean.videoId!=null">
 				#{bean.videoId},
			 </if>
 			<if test="bean.videoUserId!=null">
 				#{bean.videoUserId},
			 </if>
 			<if test="bean.commentId!=null">
 				#{bean.commentId},
			 </if>
 			<if test="bean.actionType!=null">
 				#{bean.actionType},
			 </if>
 			<if test="bean.actionCount!=null">
 				#{bean.actionCount},
			 </if>
 			<if test="bean.userId!=null">
 				#{bean.userId},
			 </if>
 			<if test="bean.actionTime!=null">
 				#{bean.actionTime},
			 </if>
		 </trim>
		on DUPLICATE key update
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="bean.videoUserId!=null">
				video_user_id =VALUES(video_user_id),
			</if>
			<if test="bean.actionCount!=null">
				action_count =VALUES(action_count),
			</if>
			<if test="bean.actionTime!=null">
				action_time =VALUES(action_time),
			</if>

		</trim>
	</insert>
	<!--添加(批量插入)-->
	<insert id="insertBatch" parameterType="com.pilipala.entity.po.UserAction">
		insert into user_action(video_id,video_user_id,comment_id,action_type,action_count,user_id,action_time)values
		<foreach collection="list" item="item" separator=",">
			(#{item.videoId},#{item.videoUserId},#{item.commentId},#{item.actionType},#{item.actionCount},#{item.userId},#{item.actionTime})
		</foreach>
	 </insert>
	<!--批量插入或更新-->
	<insert id="insertOrUpdateBatch" parameterType="com.pilipala.entity.po.UserAction">
		insert into user_action(video_id,video_user_id,comment_id,action_type,action_count,user_id,action_time)values
		<foreach collection="list" item="item" separator=",">
			(#{item.videoId},#{item.videoUserId},#{item.commentId},#{item.actionType},#{item.actionCount},#{item.userId},#{item.actionTime})
		</foreach>
			on DUPLICATE key update
            action_id= VALUES(action_id),video_id= VALUES(video_id),video_user_id= VALUES(video_user_id),comment_id= VALUES(comment_id),action_type= VALUES(action_type),action_count= VALUES(action_count),user_id= VALUES(user_id),action_time= VALUES(action_time)
	</insert>
	<!-- 根据"ActionId"查询-->
	<select id="selectByActionId" resultMap="base_result_map">
		select <include refid="base_column_list"/>  from user_action where action_id=#{actionId}
	</select>
	<!-- 根据"ActionId"更新-->
	<update id="updateByActionId" parameterType="com.pilipala.entity.po.UserAction">
		update  user_action
		<set>
			<if test="bean.actionId!=null">
			action_id=#{bean.actionId},
			</if>
			<if test="bean.videoId!=null">
			video_id=#{bean.videoId},
			</if>
			<if test="bean.videoUserId!=null">
			video_user_id=#{bean.videoUserId},
			</if>
			<if test="bean.commentId!=null">
			comment_id=#{bean.commentId},
			</if>
			<if test="bean.actionType!=null">
			action_type=#{bean.actionType},
			</if>
			<if test="bean.actionCount!=null">
			action_count=#{bean.actionCount},
			</if>
			<if test="bean.userId!=null">
			user_id=#{bean.userId},
			</if>
			<if test="bean.actionTime!=null">
			action_time=#{bean.actionTime},
			</if>
		</set>
		<where>
			action_id=#{actionId}
		</where>
	</update>

	<!-- 根据"ActionId"删除-->
	<delete id="deleteByActionId">
		delete from user_action where action_id=#{actionId}
	</delete>

	<!-- 根据"VideoIdAndCommentIdAndActionTypeAndUserId"查询-->
	<select id="selectByVideoIdAndCommentIdAndActionTypeAndUserId" resultMap="base_result_map">
		select <include refid="base_column_list"/>  from user_action where video_id=#{videoId} and comment_id=#{commentId} and action_type=#{actionType} and user_id=#{userId}
	</select>
	<!-- 根据"VideoIdAndCommentIdAndActionTypeAndUserId"更新-->
	<update id="updateByVideoIdAndCommentIdAndActionTypeAndUserId" parameterType="com.pilipala.entity.po.UserAction">
		update  user_action
		<set>
			<if test="bean.actionId!=null">
			action_id=#{bean.actionId},
			</if>
			<if test="bean.videoId!=null">
			video_id=#{bean.videoId},
			</if>
			<if test="bean.videoUserId!=null">
			video_user_id=#{bean.videoUserId},
			</if>
			<if test="bean.commentId!=null">
			comment_id=#{bean.commentId},
			</if>
			<if test="bean.actionType!=null">
			action_type=#{bean.actionType},
			</if>
			<if test="bean.actionCount!=null">
			action_count=#{bean.actionCount},
			</if>
			<if test="bean.userId!=null">
			user_id=#{bean.userId},
			</if>
			<if test="bean.actionTime!=null">
			action_time=#{bean.actionTime},
			</if>
		</set>
		<where>
			video_id=#{videoId} and comment_id=#{commentId} and action_type=#{actionType} and user_id=#{userId}
		</where>
	</update>

	<!-- 根据"VideoIdAndCommentIdAndActionTypeAndUserId"删除-->
	<delete id="deleteByVideoIdAndCommentIdAndActionTypeAndUserId">
		delete from user_action where video_id=#{videoId} and comment_id=#{commentId} and action_type=#{actionType} and user_id=#{userId}
	</delete>

</mapper>